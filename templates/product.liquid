{%- comment -%}
  Premium Product Page Template
{%- endcomment -%}

<div class="product-page" id="product-{{ product.id }}">
  <div class="product-page__inner container">
    <div class="product-page__grid">
      {%- comment -%} Product Images {%- endcomment -%}
      <div class="product-page__images">
        <div class="product-gallery">
          <div class="product-gallery__main">
            {%- if product.featured_image -%}
              <img src="{{ product.featured_image | image_url: width: 1200 }}" alt="{{ product.title | escape }}" id="main-image" class="product-gallery__main-img" loading="eager">
            {%- endif -%}
            <div class="product-gallery__zoom" id="zoom-area"></div>
          </div>
          
          {%- if product.images.size > 1 -%}
            <div class="product-gallery__thumbnails">
              {%- for image in product.images -%}
                <button type="button" class="product-gallery__thumbnail {% if forloop.first %}is-active{% endif %}" data-image="{{ image | image_url: width: 1200 }}">
                  <img src="{{ image | image_url: width: 150 }}" alt="{{ product.title | escape }}" loading="lazy">
                </button>
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>
      </div>

      {%- comment -%} Product Info {%- endcomment -%}
      <div class="product-page__info">
        <div class="product-info">
          <h1 class="product-info__title">{{ product.title }}</h1>
          
          {%- if product.vendor != blank -%}
            <p class="product-info__vendor">By {{ product.vendor }}</p>
          {%- endif -%}

          <div class="product-info__price">
            {%- if product.compare_at_price > product.price -%}
              <span class="price--compare">{{ product.compare_at_price | money }}</span>
            {%- endif -%}
            <span class="price--current">{{ product.price | money }}</span>
          </div>

          {%- if product.description != blank -%}
            <div class="product-info__description">
              {{ product.description }}
            </div>
          {%- endif -%}

          {%- form 'product', product, class: 'product-form' -%}
            {%- unless product.has_only_default_variant -%}
              <div class="product-form__variants">
                {%- for option in product.options_with_values -%}
                  <div class="product-form__option">
                    <label class="product-form__label">{{ option.name }}</label>
                    <div class="product-form__options">
                      {%- for value in option.values -%}
                        <button type="button" class="product-form__option-btn {% if option.selected_value == value %}is-selected{% endif %}" data-option="{{ option.name }}" data-value="{{ value }}">
                          {{ value }}
                        </button>
                      {%- endfor -%}
                    </div>
                  </div>
                {%- endfor -%}
              </div>
            {%- endunless -%}

            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="variant-id">

            <div class="product-form__quantity">
              <label class="product-form__label">Quantity</label>
              <div class="quantity-selector">
                <button type="button" class="quantity-btn" data-action="decrease">-</button>
                <input type="number" name="quantity" value="1" min="1" class="quantity-input" id="quantity">
                <button type="button" class="quantity-btn" data-action="increase">+</button>
              </div>
            </div>

            {%- comment -%} Gift Options {%- endcomment -%}
            <div class="product-form__gift-options">
              <label class="product-form__checkbox">
                <input type="checkbox" name="properties[Gift Wrap]">
                <span>Add Premium Gift Wrap (+$5.00)</span>
              </label>
              <label class="product-form__checkbox">
                <input type="checkbox" name="properties[Personalized Message]">
                <span>Add Personalized Message</span>
              </label>
              {%- if product.selected_or_first_available_variant.available -%}
                <textarea name="properties[Personalized Text]" placeholder="Enter your personalized message..." class="product-form__personalized-text" style="display: none;"></textarea>
              {%- endif -%}
            </div>

            {%- comment -%} Trust Badges {%- endcomment -%}
            <div class="product-info__trust-badges">
              <div class="trust-badge">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M7 10L9 12L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Free Shipping</span>
              </div>
              <div class="trust-badge">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>30-Day Returns</span>
              </div>
            </div>

            {%- comment -%} Valentine Urgency {%- endcomment -%}
            <div class="product-info__urgency">
              <p>‚è∞ Order within <strong>2 hours</strong> for Valentine's Day delivery!</p>
            </div>

            <button type="submit" class="btn btn--primary btn--large product-form__submit" {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}>
              {%- if product.selected_or_first_available_variant.available -%}
                Add to Cart
              {%- else -%}
                Sold Out
              {%- endif -%}
            </button>
          {%- endform -%}
        </div>
      </div>
    </div>

    {%- comment -%} Related Products {%- endcomment -%}
    {%- if collection.products.size > 1 -%}
      <div class="product-page__related">
        <h2 class="section__title">You May Also Like</h2>
        <div class="product-page__related-grid grid grid--4">
          {%- for related_product in collection.products limit: 4 -%}
            {%- unless related_product.id == product.id -%}
              {% render 'product-card', product: related_product %}
            {%- endunless -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

{%- comment -%} Sticky Add to Cart {%- endcomment -%}
<div class="sticky-add-to-cart" id="sticky-add-to-cart">
  <div class="sticky-add-to-cart__inner container">
    <div class="sticky-add-to-cart__info">
      <img src="{{ product.featured_image | image_url: width: 80 }}" alt="{{ product.title }}" class="sticky-add-to-cart__image">
      <div>
        <h3 class="sticky-add-to-cart__title">{{ product.title }}</h3>
        <p class="sticky-add-to-cart__price">{{ product.price | money }}</p>
      </div>
    </div>
    <button type="button" class="btn btn--primary" onclick="document.querySelector('.product-form__submit').click()">
      Add to Cart
    </button>
  </div>
</div>

<style>
  .product-page {
    padding: 3rem 0;
  }

  .product-page__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    margin-bottom: 4rem;
  }

  .product-gallery__main {
    position: relative;
    margin-bottom: 1rem;
    cursor: zoom-in;
  }

  .product-gallery__main-img {
    width: 100%;
    height: auto;
    border-radius: var(--radius-xl, 16px);
  }

  .product-gallery__thumbnails {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
  }

  .product-gallery__thumbnail {
    width: 80px;
    height: 80px;
    padding: 0;
    border: 2px solid transparent;
    border-radius: var(--radius-md, 8px);
    overflow: hidden;
    cursor: pointer;
    transition: border-color 0.2s ease;
    background: none;
  }

  .product-gallery__thumbnail.is-active {
    border-color: var(--color-rose, #D4A5A5);
  }

  .product-gallery__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-info__title {
    font-family: var(--font-heading, 'Playfair Display', serif);
    font-size: clamp(2rem, 3vw, 2.5rem);
    margin-bottom: 0.5rem;
  }

  .product-info__vendor {
    color: rgba(44, 44, 44, 0.6);
    margin-bottom: 1rem;
  }

  .product-info__price {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .product-info__price .price--compare {
    text-decoration: line-through;
    color: rgba(44, 44, 44, 0.5);
    font-size: 1.25rem;
  }

  .product-info__price .price--current {
    font-size: 2rem;
    font-weight: 600;
    color: var(--color-rose, #D4A5A5);
  }

  .product-info__description {
    margin-bottom: 2rem;
    line-height: 1.8;
  }

  .product-form__variants {
    margin-bottom: 2rem;
  }

  .product-form__option {
    margin-bottom: 1.5rem;
  }

  .product-form__label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .product-form__options {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .product-form__option-btn {
    padding: 0.75rem 1.5rem;
    border: 2px solid rgba(44, 44, 44, 0.2);
    border-radius: var(--radius-lg, 12px);
    background: var(--color-white, #FFFFFF);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .product-form__option-btn:hover,
  .product-form__option-btn.is-selected {
    border-color: var(--color-rose, #D4A5A5);
    background: rgba(212, 165, 165, 0.1);
    color: var(--color-rose, #D4A5A5);
  }

  .product-form__quantity {
    margin-bottom: 2rem;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    gap: 1rem;
    max-width: 150px;
  }

  .quantity-input {
    flex: 1;
    padding: 0.75rem;
    text-align: center;
    border: 2px solid rgba(44, 44, 44, 0.1);
    border-radius: var(--radius-lg, 12px);
  }

  .product-form__gift-options {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(244, 209, 209, 0.1);
    border-radius: var(--radius-lg, 12px);
  }

  .product-form__checkbox {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    cursor: pointer;
  }

  .product-form__personalized-text {
    width: 100%;
    min-height: 100px;
    padding: 1rem;
    margin-top: 1rem;
    border: 2px solid rgba(44, 44, 44, 0.1);
    border-radius: var(--radius-lg, 12px);
  }

  .product-info__trust-badges {
    display: flex;
    gap: 2rem;
    margin-bottom: 1.5rem;
    padding: 1.5rem;
    background: rgba(245, 230, 211, 0.2);
    border-radius: var(--radius-lg, 12px);
  }

  .product-info__trust-badges .trust-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
  }

  .product-info__urgency {
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    background: linear-gradient(135deg, rgba(232, 180, 184, 0.2) 0%, rgba(212, 165, 165, 0.2) 100%);
    border-radius: var(--radius-lg, 12px);
    text-align: center;
  }

  .product-info__urgency p {
    margin: 0;
    font-weight: 500;
    color: var(--color-charcoal, #2C2C2C);
  }

  .sticky-add-to-cart {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--color-white, #FFFFFF);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    padding: 1rem 0;
  }

  .sticky-add-to-cart.is-visible {
    transform: translateY(0);
  }

  .sticky-add-to-cart__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  .sticky-add-to-cart__info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .sticky-add-to-cart__image {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: var(--radius-md, 8px);
  }

  .sticky-add-to-cart__title {
    font-size: 1rem;
    margin: 0 0 0.25rem 0;
  }

  .sticky-add-to-cart__price {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-rose, #D4A5A5);
    margin: 0;
  }

  @media (max-width: 1024px) {
    .product-page__grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
  }
</style>

<script>
  // Image gallery functionality
  document.querySelectorAll('.product-gallery__thumbnail').forEach(thumb => {
    thumb.addEventListener('click', function() {
      const mainImage = document.getElementById('main-image');
      const imageUrl = this.dataset.image;
      mainImage.src = imageUrl;
      
      document.querySelectorAll('.product-gallery__thumbnail').forEach(t => t.classList.remove('is-active'));
      this.classList.add('is-active');
    });
  });

  // Sticky add to cart
  const stickyCart = document.getElementById('sticky-add-to-cart');
  const productInfo = document.querySelector('.product-page__info');
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) {
        stickyCart.classList.add('is-visible');
      } else {
        stickyCart.classList.remove('is-visible');
      }
    });
  }, { threshold: 0.1 });
  
  if (productInfo) {
    observer.observe(productInfo);
  }
</script>
